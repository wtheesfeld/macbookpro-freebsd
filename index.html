<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Macbookpro-FreeBSD by wtheesfeld</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Macbookpro-FreeBSD</h1>
      <h2 class="project-tagline">Running FreeBSD 10.3-RELEASE on a mid 2012 MacBook Pro (9,2)</h2>
      <a href="https://github.com/wtheesfeld/macbookpro-freebsd" class="btn">View on GitHub</a>
      <a href="https://github.com/wtheesfeld/macbookpro-freebsd/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/wtheesfeld/macbookpro-freebsd/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="cpu-scaling" class="anchor" href="#cpu-scaling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CPU Scaling</h1>

<pre><code>Place the following lines in your /etc/rc.conf:

    powerd_enable="YES"
    powerd_flags="-a adaptive -b adaptive"
</code></pre>

<h1>
<a id="wireless" class="anchor" href="#wireless" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Wireless</h1>

<p>Wireless is bcm4331, neither bwi or bwn drivers work, needs version 5 drivers</p>

<pre><code>temp fix: using dwa-131 dongle
/boot/loader.conf:

    if_rsu_load="YES"
    legal.realtek.license_ack=1
    rsu_rtl18712fw_load="YES"
</code></pre>

<h1>
<a id="keyboard-layout" class="anchor" href="#keyboard-layout" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Keyboard Layout</h1>

<p>In the tty console the backtick/tilde key does nothing, and in Xorg the backtick/tilde key gives &lt; and &gt;. We need to load some custom keyboard layouts for both.</p>

<pre><code>TTY Fix: load new keyboard layout
Download this keyboard layout: https://github.com/wtheesfeld/macbookpro-freebsd/blob/master/us.macbook.kbd
Load it (as root. use sudo or su):

    mv us.macbook.kbd /usr/share/syscons/keymaps/us.macbook.kbd
    chmod 444 /usr/share/syscons/keymaps/us.macbook.kbd
    kbdcontrol -l /usr/share/syscons/keymaps/us.macbook.kbd 

To make this permanent system-wide, edit /etc/profile:

     kbdcontrol -l /usr/share/syscons/keymaps/us.macbook.kbd

Xorg Fix: load new keyboard map
Download this keyboard map: https://github.com/wtheesfeld/macbookpro-freebsd/blob/master/.xkbmap
Load it:

    xkbcomp -w 0 .xkbmap $DISPLAY

To load the keymap every time Xorg starts, place that line in your ~/.xinitrc
</code></pre>

<h1>
<a id="touchpad" class="anchor" href="#touchpad" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Touchpad</h1>

<p>Touchpad support works with ums driver automatically loaded, but no multi-touch.</p>

<pre><code>Fix: load ATP driver
/boot/loader.conf:

    atp_load="YES"
</code></pre>

<h1>
<a id="suspendresume-on-lid-closeopen--screen-dimming" class="anchor" href="#suspendresume-on-lid-closeopen--screen-dimming" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Suspend/Resume on lid close/open &amp; Screen Dimming</h1>

<p>Loading ACPI_VIDEO module will automatically brighten screen when AC is plugged in, and automatically dim screen when AC is unplugged. It will also give the ability to suspend on lid close and resume when opening lid.</p>

<pre><code>Fix: load ACPI_VIDEO driver
/boot/loader.conf:

    acpi_video_load="YES"

For suspend/resume
/etc/sysctl.conf:

    hw.acpi.lid_switch_state=S3
</code></pre>

<h1>
<a id="smc-sensors-temps-and-fan-control" class="anchor" href="#smc-sensors-temps-and-fan-control" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SMC Sensors (temps and fan control)</h1>

<p>NOTE: I patched against the 10.3 RELEASE source
Patch has been submitted to PR (<a href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=211513">https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=211513</a>)</p>

<p>Download and apply this patch:</p>

<pre><code>https://github.com/wtheesfeld/macbookpro-freebsd/blob/master/asmc_92.patch
move it to /usr/src/sys/dev/asmc:

     mv asmc_92.patch /usr/sys/dev/asmc

apply the patch

     cd /usr/src/sys/dev/asmc; patch &lt; asmc_92.patch

Now make the new module

     cd /usr/src/sys/modules/asmc; make

Make backup of old module:

      cp /boot/kernel/asmc.ko /boot/kernel/asmc.old

Copy new module

      cp /usr/src/sys/modules/asmc/asmc.ko /boot/kernel/asmc.ko

Test new module

      kldload asmc

If it loads ok, load module at boot:
/boot/loader.conf:

        asmc_load="YES"
</code></pre>

<p>After loading module, the following change can be made to spin the fan a little faster:</p>

<pre><code>/boot/loader.conf:

         dev.asmc.0.fan.0.minspeed=3000
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/wtheesfeld/macbookpro-freebsd">Macbookpro-FreeBSD</a> is maintained by <a href="https://github.com/wtheesfeld">wtheesfeld</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
